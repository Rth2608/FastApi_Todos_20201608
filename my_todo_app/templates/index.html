<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List</title>
    <style>
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            margin: 10px 0;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            margin-left: 5px;
        }
    </style>
    <script>
        async function loadTodos() {
            const response = await fetch('/todos');
            if (!response.ok) {
                console.error("To-Do 데이터를 가져오는 중 오류 발생");
                return;
            }
            const todos = await response.json();
            console.log("서버에서 받은 To-Do 데이터:", todos);

            const list = document.getElementById('todo-list');
            list.innerHTML = '';

            if (todos.length === 0) {
                list.innerHTML = "<li>등록된 To-Do가 없습니다.</li>";
                return;
            }

            todos.forEach(todo => {
                const li = document.createElement('li');
                li.innerHTML = `<b>학번:</b> ${todo.student_id}, <b>이름:</b> ${todo.name} 
                                <span>(Completed: ${todo.completed})</span>
                                <button onclick="editTodo(${todo.id})">Edit</button> 
                                <button onclick="deleteTodo(${todo.id})">Delete</button>`;
                list.appendChild(li);
            });
        }

        async function addTodo() {
            const studentId = document.getElementById('student-id').value;
            const name = document.getElementById('name').value;
            if (!studentId || !name) {
                alert("학번과 이름을 입력해주세요!");
                return;
            }

            const newTodo = {
                id: Date.now(),
                student_id: studentId,
                name: name,
                completed: false
            };

            await fetch('/todos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newTodo)
            });

            document.getElementById('student-id').value = '';
            document.getElementById('name').value = '';
            loadTodos();
        }

        async function deleteTodo(id) {
            await fetch(`/todos/${id}`, { method: 'DELETE' });
            loadTodos();
        }

        async function editTodo(id) {
            const newName = prompt("새로운 이름을 입력하세요:");
            if (!newName) return;

            const response = await fetch(`/todos/${id}`);
            if (!response.ok) {
                alert("수정할 항목을 찾을 수 없습니다.");
                return;
            }

            const todo = await response.json();
            todo.name = newName;

            await fetch(`/todos/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(todo)
            });

            loadTodos();
        }

        window.onload = loadTodos;
    </script>
</head>
<body>
    <h1>To-Do List</h1>
    <ul id="todo-list"></ul>
    
    <input type="text" id="student-id" placeholder="학번">
    <input type="text" id="name" placeholder="이름">
    <button onclick="addTodo()">Add To-Do</button>

    <br><br> <!-- 공간을 조금 띄워줌 -->

    <!-- ✅ 여기에 추가 -->
    <input type="text" id="filter-student-id" placeholder="조회할 학번">
    <button onclick="filterByStudent()">조회</button>
</body>

</html>
